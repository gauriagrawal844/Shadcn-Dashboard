generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String      @id @default(uuid())
  name              String
  email             String      @unique
  phone             String
  verificationToken String?  
  emailVerified     Boolean     @default(false)
  otp               String?    
  otpExpires        DateTime?  
  cards             Card[]      // One-to-many relation with Card
  visitors          Visitor[]   // One-to-many relation with Visitor
  tableEntries      TableEntry[] // One-to-many relation with TableEntry
  createdAt         DateTime    @default(now())
}

/// Stores OTPs for verifying an email during signup before creating a User
model EmailVerification {
  id          String   @id @default(uuid())
  email       String   @unique
  otp         String
  otpExpires  DateTime
  verified    Boolean  @default(false)
  createdAt   DateTime @default(now())
}

model Card {
  id            String   @id @default(uuid())
  heading       String
  currentValue  Float
  previousValue Float?
  changePercent Float?
  description   String?
  note          String?
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, heading])  // Ensures a user can't have duplicate card headings
}


model Visitor {
  id        Int      @id @default(autoincrement())
  date      DateTime
  desktop   Int
  mobile    Int
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  
  @@unique([userId, date])  // Ensures a user can't have duplicate dates
}


model TableEntry {
  id        Int      @id @default(autoincrement())
  header    String
  type      String
  status    String
  target    Int
  limit     Int
  reviewer  String?
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  
  @@unique([userId, header])  // Ensures a user can't have duplicate table entry headers
}

